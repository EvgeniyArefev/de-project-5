# Опиасние данных

## Витрина cdm.dm_courier_ledger

Необходимо построить витрину, содержащую информацию о выплатах курьерам.

Состав витрины:

- `id` — идентификатор записи.
- `courier_id` — ID курьера, которому перечисляем.
- `courier_name` — Ф. И. О. курьера.
- `settlement_year` — год отчёта.
- `settlement_month` — месяц отчёта, где 1 — январь и 12 — декабрь.
- `orders_count` — количество заказов за период (месяц).
- `orders_total_sum` — общая стоимость заказов.
- `rate_avg` — средний рейтинг курьера по оценкам пользователей.
- `order_processing_fee` — сумма, удержанная компанией за обработку заказов, которая высчитывается как orders_total_sum \* 0.25.
- `courier_order_sum` — сумма, которую необходимо перечислить курьеру за доставленные им/ей заказы. За каждый доставленный заказ курьер должен получить некоторую сумму в зависимости от рейтинга (см. ниже).
- `courier_tips_sum` — сумма, которую пользователи оставили курьеру в качестве чаевых.
- `courier_reward_sum` — сумма, которую необходимо перечислить курьеру. Вычисляется как courier_order_sum + courier_tips_sum \* 0.95 (5% — комиссия за обработку платежа).

Правила расчёта процента выплаты курьеру в зависимости от рейтинга, где r — это средний рейтинг курьера в расчётном месяце:

- r < 4 — 5% от заказа, но не менее 100 р.;
- 4 <= r < 4.5 — 7% от заказа, но не менее 150 р.;
- 4.5 <= r < 4.9 — 8% от заказа, но не менее 175 р.;
- 4.9 <= r — 10% от заказа, но не менее 200 р.

## Описание DDS слоя

Модель данных для слоя DDS - "звезда"

Таблицы измерений:

- `dds.dm_orders`
- `dds.dm_deliveries`
- `dds.dm_couriers`

Таблица фактов:

- `dds.fct_deliveries`

## Описание Staging слоя

Из `API` нам потребуется выгрзить две таблицы.

Методом `/couriers` наполним таблицу `stg.couriers`

Методом `/deliveries` наполним таблицу `stg.deliveries`
